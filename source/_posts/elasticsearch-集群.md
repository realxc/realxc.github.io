title: elasticsearch-集群
author: Xiang Chuang
tags:
  - elk
  - 集群
categories:
  - 爱学爱问
date: 2017-09-27 16:02:00
---
ElasticSearch 的主旨是随时可用和按需扩容。 
1、通过购买性能更强大（ 垂直扩容 ，或 纵向扩容） 扩容能力有限   
2、数量更多的服务器（ 水平扩容 ，或 横向扩容 ） （elasticsearch天生分布式）     

一个运行中的 Elasticsearch 实例称为一个 节点，而集群是由一个或者多个拥有相同 cluster.name 配置的节点组成， 它们共同承担数据和负载的压力。当有节点加入集群中或者从集群中移除节点时，集群将会重新平均分布所有的数据。

主 节点： 负责管理集群范围内的所有变更（如增加、删除索引，或者增加、删除节点等），不需要涉及到文档级别的变更和搜索等操作，所以当集群只拥有一个主节点的情况下，即使流量的增加它也不会成为瓶颈。 任何节点都可以成为主节点。用户可以将请求发送到 集群中的任何节点 ，包括主节点。 每个节点都知道任意文档所处的位置，并且能够将我们的请求直接转发到存储我们所需文档的节点。 无论我们将请求发送到哪个节点，它都能负责从各个包含我们所需文档的节点收集回数据，并将最终结果返回給客户端。 Elasticsearch 对这一切的管理都是透明的。

查询集群健康：GET /_cluster/health
status
green  所有的主分片和副本分片都正常运行。 
yellow  所有的主分片都正常运行，但不是所有的副本分片都正常运行。 
red  有主分片没能正常运行。

索引实际上是指向一个或者多个物理 分片（仅保存了 全部数据中的一部分，一个分片是一个 Lucene 的实例） 的 逻辑命名空间 。
初始化索引的分片（默认5个主分片）
PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}
调整副分片大小
PUT /blogs/_settings
{
   "number_of_replicas" : 2
}